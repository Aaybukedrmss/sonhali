@model dotnet_store.Models.CartIndexViewModel
@{
    ViewData["Title"] = "Sepetim";
}

@section Bar{
    @await Html.PartialAsync("Partials/_Navbar")
}

<div class="container py-4">
    <h2 class="mb-4">Sepetim</h2>

    @if (!Model.Items.Any())
    {
        <div class="alert alert-info">Sepetiniz boş.</div>
    }
    else
    {
        <div class="row">
            <div class="col-lg-8">
                <div class="list-group mb-3">
                    @foreach (var item in Model.Items)
                    {
                        <div class="list-group-item d-flex align-items-center gap-3">
                            <div style="width:64px;height:64px;flex:0 0 64px;display:flex;align-items:center;justify-content:center;background:var(--surface);border:1px solid #f7c7ba;border-radius:6px;">
                                @inject dotnet_store.Services.IProductImageService ImgSvc
                                @{ var img = await ImgSvc.GetPrimaryImageUrlByIsbnAsync(item.Urun!.Isbn); }
                                @if (!string.IsNullOrWhiteSpace(img))
                                {
                                    <img src="@img" alt="@item.Urun!.ProductName" style="max-width:100%;max-height:100%;object-fit:contain;" />
                                }
                            </div>
                            <div class="flex-fill">
                                <div class="fw-bold">@item.Urun!.ProductName</div>
                                <div class="text-muted small">Birim fiyat: @item.UnitPrice.ToString("C")</div>
                            </div>
                            <form asp-action="Update" method="post" class="d-flex align-items-center gap-2">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="itemId" value="@item.Id" />
                                <input type="number" name="quantity" value="@item.Quantity" min="0" class="form-control" style="width: 100px;" />
                                <button type="submit" class="btn btn-outline-secondary">Güncelle</button>
                            </form>
                            <form asp-action="Remove" method="post">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="itemId" value="@item.Id" />
                                <button type="submit" class="btn btn-outline-danger">Sil</button>
                            </form>
                            <div class="text-end" style="width: 140px;">
                                <div class="fw-bold">@((item.UnitPrice * item.Quantity).ToString("C"))</div>
                            </div>
                        </div>
                    }
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Özet</h5>
                        <div class="d-flex justify-content-between">
                            <span>Ara Toplam</span>
                            <strong>@Model.Subtotal.ToString("C")</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Kargo</span>
                            <strong>@Model.Shipping.ToString("C")</strong>
                        </div>
                        <hr />
                        <div class="d-flex justify-content-between">
                            <span>Toplam</span>
                            <strong>@Model.Total.ToString("C")</strong>
                        </div>
                        <a asp-action="Checkout" class="btn btn-primary w-100 mt-3">Devam Et</a>
                    </div>
                </div>
            </div>
        </div>
    }
</div>


